<script lang="ts">
  import { listen } from 'svelte/internal';
  import type { IExploitInfo, IRobloxInfo } from './ExploitInfo';
  export let ExploitInfo: IExploitInfo;
  export let RobloxInfo: IRobloxInfo = {
    last_update: new Date(0),
    last_update_unix: 0,
    version: 'version-0000000000000000',
  };
  const format = (delay: number) => {
    const date = new Date(Math.abs(delay * 1000));
    let timestr = [];
    const add = (display: string, actual?: string, offset: number = 0) => {
      actual = actual ?? display;
      const t = date['get' + actual]() + offset;
      if (t > 0) {
        timestr.push(`${t}${display}`);
        date['set' + actual](0);
      }
    };
    add('sec', 'Seconds');
    add('min', 'Minutes', 0);
    add('hr', 'Hours', -1);
    add('d', 'Date', -1);
    return timestr.reverse().join(', ');
  };
  const InternalCheats = ['DX9Ware', 'Ro-Ware', 'V-Severe'];
  const Links: Record<string, string> = {
    Temple: 'https://temple.cx/',
    'Script-Ware': 'https://script-ware.com/w',
    'Ro-Ware': 'https://script-ware.com/roware',
    Fluxus: 'https://fluxteam.xyz',
  };
</script>

<div
  class="main"
  style="display:contents"
  aria-label="Executor: {ExploitInfo.name}"
  data-name={ExploitInfo.name}
  data-updated={ExploitInfo.updated}
  data-last-updated={ExploitInfo.last_update}
  data-last-updated-unix={ExploitInfo.last_update_unix}
  data-hide-tag={ExploitInfo.hidetag}
  data-exploit-version={ExploitInfo.exploit_version}
>
  {#if ExploitInfo.updated}
    <div class="‚ßà Working">
      <h2>
        {#if Links[ExploitInfo.name]}
          <a href={Links[ExploitInfo.name]} target="_blank" class="‚õì"
            >{ExploitInfo.name}</a
          >
        {:else}
          {ExploitInfo.name}
        {/if}
        {#if !ExploitInfo.hidetag}
          ({#if InternalCheats.includes(ExploitInfo.name)}Internal{:else}Executor{/if})
        {/if}
      </h2>
      <p>
        Last Update: {ExploitInfo.last_update} ({ExploitInfo.last_update_unix})
      </p>
      <p class="üïê">
        Update Timing: {format(
          ExploitInfo.last_update_unix - RobloxInfo.last_update_unix,
        )} ({ExploitInfo.last_update_unix - RobloxInfo.last_update_unix}s)
      </p>
      <p class="üìå">Latest Version: {ExploitInfo.exploit_version}</p>
    </div>
  {:else}
    <div class="‚ßà Patched">
      <h2>
        {#if Links[ExploitInfo.name]}
          <a href={Links[ExploitInfo.name]} target="_blank" class="‚õì"
            >{ExploitInfo.name}</a
          >
        {:else}
          {ExploitInfo.name}
        {/if}
        {#if !ExploitInfo.hidetag}
          ({#if InternalCheats.includes(ExploitInfo.name)}Internal{:else}Executor{/if})
        {/if}
      </h2>
      {#if ExploitInfo.lines}
        <p>{ExploitInfo.lines[0] ?? ''}&ZeroWidthSpace;</p>
        <p class="üïê">{ExploitInfo.lines[1] ?? ''}&ZeroWidthSpace;</p>
        <p class="üìå">{ExploitInfo.lines[2] ?? ''}&ZeroWidthSpace;</p>
      {:else}
        <p>
          Last Update: {ExploitInfo.last_update} ({ExploitInfo.last_update_unix})
        </p>
        <p class="üïê">Update Timing: None (Outdated)</p>
        <p class="üìå">Latest Version: {ExploitInfo.exploit_version}</p>
      {/if}
    </div>
  {/if}
</div>

<style lang="scss">
  .main {
    max-width: 65vw;
  }
  .‚ßà {
    padding: 2px 16px;
    margin: 4px 4px;
    border-radius: 16px;
    height: 165px;
    transition: background 1s, border-radius 1s, color 1s;
    background: transparent;
    &:hover,
    &:active {
      color: #ffffff;
    }
    .‚õì {
      // links in execs
      color: #ffffff;
      text-decoration: dotted underline #ffffffaa;
    }
    h2 + p {
      margin-bottom: 4px;
    }
    .üïê {
      margin-top: 4px;
    }
    .üìå {
      color: #bbbbbb;
    }
  }
  @media screen and (min-width: 500px) {
    .‚ßà {
      display: inline-block;
      min-width: 400px;
      max-width: 450px;
    }
  }
  @media screen and (min-width: 1410px) {
    .‚ßà {
      .üïê {
        margin-bottom: 4px;
      }
      .üìå {
        margin-top: 4px;
      }
    }
  }
  @media screen and (max-width: 1410px) {
    .‚ßà {
      height: max-content;
      .üìå {
        display: none;
      }
    }
  }
  .‚ßà.Working {
    border: 2px solid #28ff88;
    &:hover,
    &:active {
      background: #4ed68b;
    }
  }
  .‚ßà.Patched {
    border: 2px solid #ff7445;
    &:hover,
    &:active {
      background: #ce7a5d;
    }
  }
</style>
